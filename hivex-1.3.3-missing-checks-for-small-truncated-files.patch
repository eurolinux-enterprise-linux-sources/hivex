diff -ur hivex-1.3.3.old/lib/hivex.c hivex-1.3.3/lib/hivex.c
--- hivex-1.3.3.old/lib/hivex.c	2015-02-27 22:10:34.570769626 +0000
+++ hivex-1.3.3/lib/hivex.c	2015-02-27 22:12:52.884176234 +0000
@@ -268,6 +268,13 @@
 
   h->size = statbuf.st_size;
 
+  if (h->size < 0x2000) {
+    fprintf (stderr, "%s: file is too small to be a Windows NT Registry hive file",
+	     filename);
+    errno = EINVAL;
+    goto error;
+  }
+
   if (!h->writable) {
     h->addr = mmap (NULL, h->size, PROT_READ, MAP_SHARED, h->fd, 0);
     if (h->addr == MAP_FAILED)
@@ -410,6 +417,13 @@
       goto error;
     }
 
+    if (off + page_size > h->size) {
+      fprintf (stderr, "%s: page size %zu at 0x%zx extends beyond end of file, bad registry",
+	       filename, page_size, off);
+      errno = ENOTSUP;
+      goto error;
+    }
+
     /* Read the blocks in this page. */
     size_t blkoff;
     struct ntreg_hbin_block *block;
